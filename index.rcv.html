<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Ordered List Example</title>
        <style>
        /* box debugging
         * {
	   border-style: solid;
	   border-color: red;
           }
         */

        /* Set the overall styles for the progress bar */
        #progressBar {
            display: flex;
            height: 20px; /* Adjust the height as needed */
            width: 100%; /* Fills the entire width of the page */
            text-align: center;
        }

        /* Each section (class) gets an individual black border */
        .barSection {
            flex: 1; /* Equal distribution of space */
            border: 1px solid black; /* Add a black border */
        }

        /* in RCV the selection is a sortable list - the defaults */
        #sortableList {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        /* the incoming choices */
        #firstList li {
            margin: 10px;
            padding: 15px;
            border: 1px solid #dfdfdf;
            background: #f5f5f5;
            list-style-type: none;
        }

        #sortableList li {
            margin: 10px;
            padding: 15px;
            border: 1px solid #dfdfdf;
            background: #f5f5f5;
        }

        #sortableList li.hint {
            border: 1px solid #ffc49a;
            background: #feffb4;
        }

        #sortableList li.active {
            border: 1px solid #ffa5a5;
            background: #ffe7e7;
        }

        </style>
    </head>
    <body>
        <!--
             Note - each contest is effectively a separate page.  The contest next button (there
             are several ways to get to the next, previous, or random other contest) resets
             the two lists to the current state of the (new) contest.

             Note that contests can be in one of three states: un-voted, undervoted, or
             voted.  The progress bar is divided into the contest number of sections, each
             section from left to rigth representing a contest.  The coloring is as follows:

             green     -> voted (completed)
             yellow    -> undervoted
             red       -> there are two cases when a progress bar section is red: a) when the
                          contest is unvoted when there is a yellow or green contest to the
                          right, or b) when the voter is on the checkout/cast-vote final page
             uncolored -> unvoted when there are no yellows/greens to the right and when the
                          voter is not on the final checkout/cast page

             For now, just stub out five contests and pretend this is the first one being
             being revisted after skipping the first two and completing the third one
        -->
        <div id="progressBar">
            <div class="barSection" id="contest1">1</div>
            <div class="barSection" id="contest2">2</div>
            <div class="barSection" id="contest3">3</div>
            <div class="barSection" id="contest4">4</div>
            <div class="barSection" id="contest5">5</div>
        </div>
        <p>Progress bar per contest</p>

        <h2>A RCV (IRV) contest:</h2>
        <ul>
            <li>Clicking a candidate will add it to your RCV</li>
            <li>Your RCV selection is re-orderable by drag-and-drop</li>
            <li>Clicking a selection's remove button un-selects a candidate</li>
        </ul>

        <h2>Your RCV selection:</h2>
        <ol id="sortableList"></ol>

        <h2>Candidates:</h2>
        <ul id="firstList">
            <li>Apple</li>
            <li>Banana</li>
            <li>Cherry</li>
        </ol>

        <script>
        // script.js
        const firstList = document.getElementById('firstList');
        const sortableList = document.getElementById('sortableList');
        const removeButtons = document.getElementsByClassName("remove");

        // set the color of the progress bar section
        function changeColor(sectionId, color) {
            const sectionElement = document.getElementById(sectionId);
            sectionElement.style.backgroundColor = color;
        }

        // Hardcoded as an example
        changeColor('contest1', '#e6e22e')
        changeColor('contest2', '#e64747')
        changeColor('contest3', '#8fb935')

        // Make the RCV selection sortable by drag-and-drop
        function initSortableList(target) {
            target.classList.add("slist");
            const items = target.getElementsByTagName("li");
            let current = null;

            for (let i of items) {
                i.draggable = true;

                i.ondragstart = (e) => {
                    current = i;
                    for (let it of items) {
                        if (it != current) {
                            it.classList.add("hint");
                        }
                    }
                };

                i.ondragenter = (e) => {
                    if (i != current) {
                        i.classList.add("active");
                    }
                };

                i.ondragleave = (e) => {
                    i.classList.remove("active");
                };

                i.ondragend = (e) => {
                    for (let it of items) {
                        it.classList.remove("hint");
                        it.classList.remove("active");
                    }
                };

                i.ondragover = (e) => e.preventDefault();

                i.ondrop = (e) => {
                    if (i != current) {
                        let currentPos = 0;
                        let droppedPos = 0;

                        for (let it = 0; it < items.length; it++) {
                            if (current == items[it]) {
                                currentPos = it;
                            }
                            if (i == items[it]) {
                                droppedPos = it;
                            }
                        }

                        if (currentPos < droppedPos) {
                            i.parentNode.insertBefore(current, i.nextSibling);
                        } else {
                            i.parentNode.insertBefore(current, i);
                        }
                    }
                };
            }
        }

        // Event listener for selection in the first list (when a candidate is selected)
        firstList.addEventListener('click', (event) => {
            if (event.target.tagName === 'LI') {
                // Create a new selected item with a remove button
                const selectedText = event.target.textContent;
                const newItem = document.createElement('li');
                newItem.classList.add("flex-item"); // Apply a class for styling

                // Create a remove button
                const newButton = document.createElement('button');
                newButton.innerText = 'remove';
                newButton.classList.add('remove'); 
                // add an event listener to the button
                newButton.addEventListener("click", function (e) {
                    var itemName = e.target.parentNode.textContent.trim().replace(/ remove$/, "");;
                    console.log("removing:", itemName);
                    // remove it from sortableList
                    e.target.parentNode.remove();
                    // add to firstList
                    const listItem = document.createElement('li');
                    listItem.textContent = itemName;
                    firstList.appendChild(listItem);
                });

                // Create a re-order glyph
                const svgIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                svgIcon.setAttribute("width", "15");
                svgIcon.setAttribute("height", "15");
                svgIcon.setAttribute("fill", "currentColor");
                svgIcon.setAttribute("fill-rule", "evenodd");
                svgIcon.setAttribute("clip-rule", "evenodd");
                // svgIcon.setAttribute("viewbox", "0 0 15 15");
                // the actual svg
                svgIcon.innerHTML = `<path d="M2.49998 4.09998C2.27906 4.09998 2.09998 4.27906 2.09998 4.49998C2.09998 4.72089 2.27906 4.89998 2.49998 4.89998H12.5C12.7209 4.89998 12.9 4.72089 12.9 4.49998C12.9 4.27906 12.7209 4.09998 12.5 4.09998H2.49998ZM2.49998 6.09998C2.27906 6.09998 2.09998 6.27906 2.09998 6.49998C2.09998 6.72089 2.27906 6.89998 2.49998 6.89998H12.5C12.7209 6.89998 12.9 6.72089 12.9 6.49998C12.9 6.27906 12.7209 6.09998 12.5 6.09998H2.49998ZM2.09998 8.49998C2.09998 8.27906 2.27906 8.09998 2.49998 8.09998H12.5C12.7209 8.09998 12.9 8.27906 12.9 8.49998C12.9 8.72089 12.7209 8.89998 12.5 8.89998H2.49998C2.27906 8.89998 2.09998 8.72089 2.09998 8.49998ZM2.49998 10.1C2.27906 10.1 2.09998 10.2791 2.09998 10.5C2.09998 10.7209 2.27906 10.9 2.49998 10.9H12.5C12.7209 10.9 12.9 10.7209 12.9 10.5C12.9 10.2791 12.7209 10.1 12.5 10.1H2.49998Z"/>`;

                // Create the text element
                const textElement = document.createElement("span");
                textElement.textContent = selectedText + "  ";

                // Append everything ...
                newItem.appendChild(svgIcon);
                newItem.appendChild(textElement);
                newItem.appendChild(newButton);
                // ... and append that to the bottom of sortableList
                sortableList.appendChild(newItem);

                // Remove the selected item from the first list
                event.target.remove();

                // Initialize the sortable list
                initSortableList(document.getElementById("sortableList"));
            }
        });

        </script>
    </body>
</html>
