<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Ordered List Example</title>
        <style>
        /*
         * {
	   border-style: solid;
	   border-color: red;
           }
         */
        /* styles.css */
        #sortableList {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        #firstList li {
            margin: 10px;
            padding: 15px;
            border: 1px solid #dfdfdf;
            background: #f5f5f5;
            list-style-type: none;
        }

        #sortableList li {
            margin: 10px;
            padding: 15px;
            border: 1px solid #dfdfdf;
            background: #f5f5f5;
        }

        #sortableList li.hint {
            border: 1px solid #ffc49a;
            background: #feffb4;
        }

        #sortableList li.active {
            border: 1px solid #ffa5a5;
            background: #ffe7e7;
        }

        </style>
    </head>
    <body>
        <p>
            <img src="drag-handle-horizontal.svg">
        </p>
            <h2>A RCV (IRV) contest:</h2>
        <ul>
            <li>Clicking a candidate will add it to your RCV</li>
            <li>Your RCV selection is re-orderable by drag-and-drop</li>
            <li>Clicking a selection's remove button un-selects a candidate</li>
        </ul>

        <h2>Your RCV selection:</h2>
        <ol id="sortableList"></ol>

        <h2>Candidates:</h2>
        <ul id="firstList">
            <li>Apple</li>
            <li>Banana</li>
            <li>Cherry</li>
        </ol>

        <script>
        // script.js
        const firstList = document.getElementById('firstList');
        const sortableList = document.getElementById('sortableList');
        const toRemoveButtons = document.getElementsByClassName("remove");

        // Make the RCV selection sortable by drag-and-drop
        function initSortableList(target) {
            target.classList.add("slist");
            const items = target.getElementsByTagName("li");
            let current = null;

            for (let i of items) {
                i.draggable = true;

                i.ondragstart = (e) => {
                    current = i;
                    for (let it of items) {
                        if (it != current) {
                            it.classList.add("hint");
                        }
                    }
                };

                i.ondragenter = (e) => {
                    if (i != current) {
                        i.classList.add("active");
                    }
                };

                i.ondragleave = (e) => {
                    i.classList.remove("active");
                };

                i.ondragend = (e) => {
                    for (let it of items) {
                        it.classList.remove("hint");
                        it.classList.remove("active");
                    }
                };

                i.ondragover = (e) => e.preventDefault();

                i.ondrop = (e) => {
                    if (i != current) {
                        let currentPos = 0;
                        let droppedPos = 0;

                        for (let it = 0; it < items.length; it++) {
                            if (current == items[it]) {
                                currentPos = it;
                            }
                            if (i == items[it]) {
                                droppedPos = it;
                            }
                        }

                        if (currentPos < droppedPos) {
                            i.parentNode.insertBefore(current, i.nextSibling);
                        } else {
                            i.parentNode.insertBefore(current, i);
                        }
                    }
                };
            }
        }

        // Event listener for selection in the first list (when a candidate is selected)
        firstList.addEventListener('click', (event) => {
            if (event.target.tagName === 'LI') {
                // Create a new selected item with a remove button
                const selectedText = event.target.textContent;
                const newItem = document.createElement('li');
                const newButton = document.createElement('button');

                newButton.innerText = 'remove';
                newButton.classList.add('remove'); 

                // TBD - this does not work
                const newSvg = document.createElementNS("http://www.w3.org/2000/svg", "img");
                newSvg.setAttributeNS('http://www.w3.org/1999/xlink', 'src', 'drag-handle-horizontal.svg');

                newItem.textContent = selectedText + "  ";
                newItem.appendChild(newButton);
                newItem.appendChild(newSvg);
                sortableList.appendChild(newItem);

                // Remove the selected item from the first list
                event.target.remove();

                // Initialize the sortable list
                initSortableList(document.getElementById("sortableList"));
            }
        });

        // TBD - Add event listener to the current buttons


        </script>
    </body>
</html>
